<!--pages/coupons/coupons.wxml-->
<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡ -->
  <view class="stats-header">
    <view class="stats-card">
      <text class="stats-number">{{totalCoupons}}</text>
      <text class="stats-label">æ€»å¡åˆ¸</text>
    </view>
    <view class="stats-card">
      <text class="stats-number">{{availableCoupons}}</text>
      <text class="stats-label">å¯ä½¿ç”¨</text>
    </view>
    <view class="stats-card">
      <text class="stats-number">{{usedCoupons}}</text>
      <text class="stats-label">å·²ä½¿ç”¨</text>
    </view>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tabs">
    <view
      wx:for="{{tabs}}"
      wx:key="id"
      class="tab-item {{activeTab === item.status ? 'tab-item-active' : ''}}"
      bindtap="switchTab"
      data-tab="{{item.status}}"
    >
      <text>{{item.name}}</text>
      <view wx:if="{{item.count > 0}}" class="tab-badge">{{item.count}}</view>
    </view>
  </view>

  <!-- å¡åˆ¸åˆ—è¡¨ -->
  <scroll-view class="coupon-list" scroll-y="true">
    <view wx:if="{{filteredCoupons.length === 0}}" class="empty-state">
      <text class="empty-icon">ğŸ«</text>
      <text class="empty-text">{{emptyText}}</text>
    </view>

    <view
      wx:for="{{filteredCoupons}}"
      wx:key="id"
      class="coupon-card fade-in {{item.status}}"
      bindtap="viewCoupon"
      data-id="{{item.id}}"
    >
      <view class="coupon-left {{item.color}}">
        <text class="coupon-emoji">{{item.emoji}}</text>
        <text class="coupon-type">{{item.type}}</text>
      </view>

      <view class="coupon-center">
        <text class="coupon-title">{{item.title}}</text>
        <text class="coupon-desc">{{item.description}}</text>
        <view class="coupon-meta">
          <text class="meta-shop">{{item.shopName}}</text>
          <text class="meta-expire">{{item.expireText}}</text>
        </view>
      </view>

      <view class="coupon-right">
        <text class="coupon-value">{{item.value}}</text>
        <view wx:if="{{item.status === 'available'}}" class="use-btn" catchtap="useCoupon" data-id="{{item.id}}">
          ä½¿ç”¨
        </view>
        <text wx:elif="{{item.status === 'used'}}" class="status-text">å·²ä½¿ç”¨</text>
        <text wx:elif="{{item.status === 'expired'}}" class="status-text">å·²è¿‡æœŸ</text>
      </view>

      <!-- å·²ä½¿ç”¨/å·²è¿‡æœŸé®ç½© -->
      <view wx:if="{{item.status !== 'available'}}" class="coupon-overlay"></view>
    </view>
  </scroll-view>

  <!-- å¡åˆ¸è¯¦æƒ…å¼¹çª— -->
  <view wx:if="{{showCouponDetail}}" class="detail-overlay" bindtap="closeDetail">
    <view class="detail-panel scale-in" catchtap="stopPropagation">
      <view class="detail-header {{selectedCoupon.color}}">
        <text class="detail-emoji">{{selectedCoupon.emoji}}</text>
        <text class="detail-title">{{selectedCoupon.title}}</text>
        <text class="detail-type">{{selectedCoupon.type}}</text>
      </view>

      <view class="detail-body">
        <view class="detail-section">
          <text class="detail-label">ä¼˜æƒ å†…å®¹</text>
          <text class="detail-value-big">{{selectedCoupon.value}}</text>
          <text class="detail-desc">{{selectedCoupon.description}}</text>
        </view>

        <view class="detail-section">
          <text class="detail-label">é€‚ç”¨å•†å®¶</text>
          <text class="detail-text">{{selectedCoupon.shopName}}</text>
        </view>

        <view class="detail-section">
          <text class="detail-label">æœ‰æ•ˆæœŸ</text>
          <text class="detail-text">{{selectedCoupon.expireDate}}</text>
        </view>

        <view class="detail-section">
          <text class="detail-label">ä½¿ç”¨è¯´æ˜</text>
          <text class="detail-text">{{selectedCoupon.rules}}</text>
        </view>

        <!-- æ ¸é”€ç (ä»…å¯ç”¨åˆ¸æ˜¾ç¤º) -->
        <view wx:if="{{selectedCoupon.status === 'available'}}" class="qr-section">
          <view class="qr-code">
            <text class="qr-placeholder">{{selectedCoupon.code}}</text>
          </view>
          <text class="qr-tip">å‡ºç¤ºæ­¤ç ç»™å•†å®¶æ ¸é”€</text>
        </view>
      </view>

      <view class="detail-actions">
        <button wx:if="{{selectedCoupon.status === 'available'}}" class="btn-primary" bindtap="showQRCode">
          ç«‹å³ä½¿ç”¨
        </button>
        <button class="btn-secondary" bindtap="closeDetail">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
